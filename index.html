<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
    <div style="background-color:#1DA1F2;height: 90px;">
        <h1 style="color:white;text-align: center;vertical-align: middle;font-size: 70px;line-height: 100%;">How Elon Musk Influences Crypto Prices</h1>
    </div>
    <div style="background-color:#1DA1F2;height: 30px;">
        <h1 style="color:white;text-align: center;vertical-align: middle;font-size: 20px;line-height: 100%;">By Vikram Duvvur</h1>
    </div>
    <br>
    
    <div width="100%">
        <button aria-label="Play">
            Play
        </button>
        <svg id="graph" style="display: flex;justify-content: center;display: block; margin: auto" width=600 height=600></svg>
    <div>
    
    <script>
        async function updatePath(data, line) {
            const updatedPath = d3
                .select("path")
                .interrupt()
                .datum(data)
                .attr("d", line);

            const pathLength = updatedPath.node().getTotalLength();
            // D3 provides lots of transition options, have a play around here:
            // https://github.com/d3/d3-transition
            const transitionPath = d3
                .transition()
                .ease(d3.easeSin)
                .duration(2500);
            updatedPath
                .attr("stroke-dashoffset", pathLength)
                .attr("stroke-dasharray", pathLength)
                .transition(transitionPath)
                .attr("stroke-dashoffset", 0);
        }
        
        async function drawLine(path, data, x, y, start, end) {
            var tmp_data = data.filter(function(d,i){ return i >= start && i<end });

            console.log(tmp_data);
            
            path.datum(tmp_data)
                .attr("fill", "none")
                .attr("stroke", "#1DA1F2")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d,i) { return x(i) })
                    .y(function(d) { return y(d.Price.replace(",","")) })
                );
        }
        async function init() {
            var data = await d3.csv("https://raw.githubusercontent.com/vkrd/vkrd.github.io/master/Bitcoin.csv");

            var height_c = 600;
            var width_c = 1500;
            var margin_c = 50;

            var x = d3.scaleLinear().domain([0, 210]).range([0,width_c - 2*margin_c]);
            var y = d3.scaleLinear().domain([0, 80000]).range([height_c - 2*margin_c,0]);

            var svg = d3.select("#graph").attr("height", height_c).attr("width", width_c);
            
            var path = svg.append("g").attr("transform","translate(" + margin_c + "," + margin_c + ")")
            .append("path");
            
            svg.append("g")
            .attr("transform","translate("+margin_c+","+margin_c+")")
            .call(d3.axisLeft(y).tickFormat(d3.format("~s")));

            svg.append("g")
            .attr("transform","translate("+margin_c+","+ (height_c - margin_c) + ")")
            .call(d3.axisBottom(x).tickFormat(d3.format("~s")));
            
            var i = 0;
            while (i < 200) {
                drawLine(path, data, x, y, 0, i);
                await new Promise(r => setTimeout(r, 20));

                i++;
            }
        }

        </script>
    </body>
</html>